<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

  <meta charset="UTF-8" />
  <title>Create Challenge</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <style>
    body { font-family: system-ui, sans-serif; max-width:700px; margin:3rem auto; padding:1rem; }
    input, textarea, button { width:100%; padding:0.5rem; margin-bottom:1rem; font-size:1rem; border-radius:4px; border:1px solid #ccc; box-sizing:border-box; }
    button { cursor:pointer; border:none; background-color:#4caf50; color:white; }
    label { font-weight:bold; margin-bottom:0.25rem; display:block; }
    small { color:#555; display:block; margin-bottom:0.5rem; }
    nav {
  display: flex;
  gap: 1rem;
  margin-bottom: 2rem;
}

nav a {
  text-decoration: none;
  font-weight: 600;
  color: #0066cc;
}

nav a:hover {
  text-decoration: underline;
}

  </style>
</head>
<body>
<nav>
  <a href="index.html">Home</a>
  <a href="create.html">Create</a>
  <a href="browse.html">Browse</a>
  <a href="auth.html" id="auth-link">Login</a>
</nav>


  <h1>Create Challenge</h1>

  <form id="challenge-form">
    <label>Challenge Title</label>
    <input type="text" placeholder="Nuzlocke Run" required>

    <label>Game</label>
    <input type="text" placeholder="Pokémon Emerald" required>

    <label>Description</label>
    <textarea placeholder="Describe your challenge..." rows="3"></textarea>

    <label>Objectives (one per line)</label>
    <textarea placeholder="Catch first Pokémon&#10;No healing items" rows="5" required></textarea>

    <button type="submit">Create Challenge</button>
  </form>

  <script>
    const SUPABASE_URL = "https://ffbqgczghzervntyhfvd.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZmYnFnY3pnaHplcnZudHloZnZkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgzNzU1MTAsImV4cCI6MjA4Mzk1MTUxMH0.N8eowQR-yhK9Hd6PrvxdHR30GYWc7U2xGdzJNw4u5U4";

    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    const form = document.getElementById("challenge-form");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const inputs = form.querySelectorAll("input, textarea");
      const title = inputs[0].value.trim();
      const game = inputs[1].value.trim();
      const description = inputs[2].value.trim();
      const objectivesRaw = inputs[3].value.trim();

      if (!title || !game || !objectivesRaw) { alert("Please fill in all required fields."); return; }

      const objectives = objectivesRaw
        .split("\n")
        .map(o => o.trim())
        .filter(o => o.length > 0)
        .map(o => ({ text:o, done:false }));

      const editKey = Math.random().toString(36).substring(2,10);

      const { data, error } = await supabaseClient
        .from("challenges")
        .insert([{ title, game, description, objectives, edit_key:editKey }])
        .select()
        .single();

      if (error) { alert("Error creating challenge: "+error.message); console.error(error); return; }

      window.location.href = `view.html?id=${data.id}&edit=${editKey}`;
    });

  </script>

</body>
</html>
